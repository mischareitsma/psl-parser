# PSL Parser Build Information

This document discussed the various files and steps that are used to build this
project

## TypeScript Configuration Files

There are two different typescript configuration files in this project:

- [**tsconfig.json**](/tsconfig.json): TypeScript configuration file that
  compiles both the sources and tests.
- [**tsconfig.build.json**](/tsconfig.build.json): TypeScript configuration file
  that only compiles the sources.

## NPM Scripts

This section gives an overview of the various **npm** scripts that are
available.

| Script | Description |
| ------ | ----------- |
| **clean** | Clean all output files generated by the compiler. |
| **precompile**| Runs before the compile. Runs the **clean** script. |
| **compile** | Runs the TypeScript compiler for both tests and sources. |
| **lint** | Runs **eslint** over the full project. |
| **watch** | Runs **build** in watch mode. |
| **test** | Runs all tests using **jest**. |
| **dist** | Runs the TypeScript compiler for the source only, generating the distributed files. |
| **prebuild** | Runs before the build. Runs the **clean**, **lint** and **test** script, making sure the build is valid. |
| **build** | Generates a full build ready to be released. This script executes the **dist**, **generate-package-json** and **copy-extra-files-dist** scripts. |
| **generate-package-json** | This script will generate a trimmed down version of the package JSON file that will be shipped with the release. |
| **copy-extra-files-dist** | This script will copy files to the `dist/` directory that should be shipped with a release. |
| **release** | Release a new version of the PSL parser. This will call the **build** script and runs **npm publish**. |

## Development Steps

This section describes how to work on the project, and ultimately needs to be
transformed into a CONTRIBUTING guide for contributors and maintainers.

### Contributing to the Project

This section describes how to contribute any change to the project. If the
change is done in a fresh clone of the repository, make sure to run:

```shell
npm install
```

After that, the general workflow for any change is:

- Create a new branch from `main`.
- Apply the changes in this new branch. If any new changes affect source code,
  make sure the associated unit tests are either updated or created.
- Run `npm run lint`. This will run `eslint`, and find any inconsistencies in
  coding guidelines and quality.
- Run `npm run test`. This will compile the full project and run all test
  suites.
- If the previous two steps ran successful, the changes can be put up for review
  in a pull request.

### Releasing a New Version

This section is meant for those that maintain the main `ing-bank/psl-parser`
project, and describes how to create a new release. The following workflow
can be followed for a release:

- Make sure that the version in the [`package.json`](/package.json) is updated
  to the correct version. Check the [version numbers](#version-numbering)
  section for how to increment the version number.
- Make sure the [`CHANGELOG.md`](/CHANGELOG.md) is updated with the latest
  changes, and that a new empty **Unreleased** section is added.
- Create a new release in GitHub:
  - As tag, use `vx.y.z` for version `x.y.z` in the `package.json` file.
  - As release name, use `Release x.y.z`.
  - For release notes, generate them first, as this will give a nice overview
    of pull request and issues that are in the release, and makes the
    contributes visible. In addition to the generate release notes add a link
    to the section of this release in the `CHANGELOG.md` file.

Github actions that are running on tags that start with a `v` will run, which
will run

```shell
npm run release
```

This script will go through all the steps to release (lint, compile, test,
build and publish).

## Version Numbering

This project is using the standard semantic versioning scheme of
`major.minor.patch`. The numbers increment as follows:

- Major: Any breaking changes in the API. Increasing the major number signals
  users of this module that it is highly likely they need to change their
  software as well.
- Minor: New non-breaking features. Any software project that is using this
  module can safely update without the project breaking.
- Patch: Bugfixes and non-breaking updates in dependencies. Increment the
  patch number if a bug is fixed, or if a version of a direct dependency is
  incremented, and the new version is not causing any breaking changes. Do not
  update this number if only downstream dependencies are updated (i.e.: only
  the package-lock.json file has an update, but the package.json file stays
  the same.)

## Updating Dependencies to Latest

It is good practice to make sure that all the dependencies are regularly
updated. The `npm outdated` command can show which dependencies are not up to
date anymore. An `npm update` will not update all the dependencies to the latest
version. For that, the `npm-check-updates` module can be used. To run:

```shell
npx npm-check-updates -u
```

This will update the `package.json` file with all the latest versions of all
dependencies. After that run:

```shell
npm install
```

To verify the update of dependencies did not break anything run

```shell
npm run build
```

This will go through the entire process of linting, compiling, testing and
preparing the dist folder with the distributed files. If that is all okay,
increment the patch number and push the changes.
